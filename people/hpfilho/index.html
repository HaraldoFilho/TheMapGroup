<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico">
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="user.js"></script>
<script src="locations.js"></script>
<script src="countries.js"></script>
<script src="../../countries_bbox.js"></script>
<link href="../../style.css" rel="stylesheet" />
<script src="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css" rel="stylesheet" />
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
#menu { position: absolute; background: #fff; padding: 10px;
font-family: 'Open Sans', sans-serif; cursor: default; }
</style>
</head>

<body>

<div id="map" onclick="closeOverlay()"></div>
<div id="menu">
<input id="streets-v11" type="radio" name="rtoggle" value="streets" checked="checked" />
<label for="streets-v11">streets</label>
<input id="outdoors-v11" type="radio" name="rtoggle" value="outdoors" />
<label for="outdoors-v11">outdoors</label>
<input id="satellite-v9" type="radio" name="rtoggle" value="satellite" />
<label for="satellite-v9">satellite</label>
</div>

<div id="nav-button" class="nav-button" onclick="toggleOverlay()">
  &#9776;
</div>

<div id="overlay" class="overlay">
  <div class="overlay-content">

   <div id="main-container" class="main-container">

    <div id="user-container" class="user-container">
      <div id="avatar" class="avatar"></div>
      <div id="user-name" class="user-name"></div>
      <div id="n-countries" class="n-countries"></div>
      <div id="u-place-icon" class="place-icon"><img class="tiny_icon" src="../../icons/place.svg"/></div>
      <div id="n-markers" class="n-markers"></div>
      <div id="u-photo-icon" class="photo-icon"><img class="tiny_icon" src="../../icons/photo.svg"/></div>
      <div id="n-photos" class="n-photos"></div>
    </div>

    <div id="countries-container" class="countries-container">
      <div id="flags" class="flags"></div>
      <div id="countries" class="countries"></div>
      <div id="places" class="places"></div>
      <div id="place-icon" class="place-icon"></div>
      <div id="photos" class="photos"></div>
      <div id="photo-icon" class="photo-icon"></div>
    </div>

  </div>

  </div>
</div>

<div style="bottom:0;font-family:arial;font-size:10px;position:fixed;margin-left:150px;margin-bottom:10px;">
    Map generated by <b>The Map Group</b> on <i><b>Flickrâ„¢</b></i>. <a href="https://www.flickr.com/groups/the-map-group/" target="_blank">Get yours</a> by joining the group!
</div>

<script>

    document.title = user_info["name"].concat(" | Photos Map");

    mapboxgl.accessToken = 'pk.eyJ1IjoiaGFyYWxkby1maWxobyIsImEiOiJja2RxN3E4aXQyMDhlMnlsNXE4b3k4M2EzIn0.dc6ab7DDUcG_B373WIdsnw';

    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11'
    });

    map.addControl(new mapboxgl.FullscreenControl({container: document.querySelector('body')}));
    map.addControl(new mapboxgl.NavigationControl());

    var layerList = document.getElementById('menu');
    var inputs = layerList.getElementsByTagName('input');

    function switchLayer(layer) {
        var layerId = layer.target.id;
        map.setStyle('mapbox://styles/mapbox/' + layerId);
    }

    for (var i = 0; i < inputs.length; i++) {
        inputs[i].onclick = switchLayer;
    }

    var west = 180;
    var south = 90;
    var east = -180;
    var north = -90;

    locations.forEach(addMarker);

    map.fitBounds([
        [west, south],
        [east, north]],
        {padding: 150}
    );

    function addMarker(value) {

        if (value[2] <= 35) {

            new mapboxgl.Marker({color:'#C2185B',scale:0.7,draggable:false})
                .setLngLat(value[0])
                .setPopup(new mapboxgl.Popup({closeButton:false,maxWidth:'566px'}).setHTML(value[1]))
                .addTo(map);
        } else {

            new mapboxgl.Marker({color:'#C2185B',scale:0.7,draggable:false})
                .setLngLat(value[0])
                .setPopup(new mapboxgl.Popup({closeButton:false,maxWidth:'592px'}).setHTML(value[1]))
                .addTo(map);
        }

        if (value[0][0] < west) {
            west = value[0][0];
        }

        if (value[0][0] > east) {
            east = value[0][0];
        }

        if (value[0][1] < south) {
            south = value[0][1];
        }

        if (value[0][1] > north) {
            north = value[0][1];
        }

    }

    var current_region;

    function toggleOverlay() {
      if (document.getElementById("overlay").style.width == "0px") {
        openOverlay();
      } else {
        closeOverlay();
      }
    }

    function openOverlay() {
      document.getElementById("overlay").style.width = "400px";
      document.getElementById("menu").style.display = "none";
      document.getElementById("nav-button").style.margin = "60px 0 0 400px";
      fitRegion(current_region);
    }

    function closeOverlay() {
      document.getElementById("overlay").style.width = "0px";
      document.getElementById("menu").style.display = "block";
      document.getElementById("nav-button").style.display = "block";
      document.getElementById("nav-button").style.margin = "60px 0 0 0";
      fitRegion(current_region);
    }

    window.onkeyup = function (event) {
      if (event.keyCode == 27) {
        closeOverlay();
      }
    }

    var avatar= document.createElement("IMG");
    avatar.setAttribute("style", "border-radius: 50%");
    avatar.setAttribute("src", user_info["avatar"]);
    avatar.setAttribute("width", "80px");
    avatar.setAttribute("height", "80px");
    document.getElementById("avatar").appendChild(avatar);

    var member_name = user_info["name"];

    if (member_name.length > 15) {
        member_name = member_name.substring(0, 14).concat("...");
    }

    var member_link = document.createElement("A");
    member_link.setAttribute("id", "member_link");
    member_link.setAttribute("href", user_info["url"]);
    member_link.setAttribute("target", "_blank");
    document.getElementById("user-name").appendChild(member_link);
    document.getElementById("member_link").innerText = member_name;

    document.getElementById("n-countries").innerText = countries.length.toString().concat(" countries");
    document.getElementById("n-markers").innerText = user_info["markers"];
    document.getElementById("n-photos").innerText = user_info["photos"];

    for (var i = 0; i < countries.length; i++) {

        var country_code = countries[i][0];
        var country_name = countries_bbox[country_code][0];
        if (country_name.length > 15) {
            country_name = country_name.substring(0, 14).concat("...");
        }

        var i_flags = document.createElement("IMG");
        var icon_src = getIconSrc(countries_bbox[country_code][0]);
        i_flags.setAttribute("class", "tiny_icon");
        i_flags.setAttribute("src", icon_src);
        document.getElementById("flags").appendChild(i_flags);

        var i_countries = document.createElement("P");
        i_countries.setAttribute("class", "item");
        i_countries.setAttribute("id", country_code);
        i_countries.innerText = country_name;
        document.getElementById("countries").appendChild(i_countries);

        var i_places = document.createElement("P");
        i_places.setAttribute("class", "item");
        i_places.innerText = countries[i][2];
        document.getElementById("places").appendChild(i_places);

        var i_places_icon = document.createElement("IMG");
        var icon_src = "../../icons/place.svg";
        i_places_icon.setAttribute("class", "tiny_icon");
        i_places_icon.setAttribute("src", icon_src);
        document.getElementById("place-icon").appendChild(i_places_icon);

        var i_photos = document.createElement("P");
        i_photos.setAttribute("class", "item");
        i_photos.innerText = countries[i][3];
        document.getElementById("photos").appendChild(i_photos);

        var i_photos_icon = document.createElement("IMG");
        var icon_src = "../../icons/photo.svg";
        i_photos_icon.setAttribute("class", "tiny_icon");
        i_photos_icon.setAttribute("src", icon_src);
        document.getElementById("photo-icon").appendChild(i_photos_icon);
    }

    function getIconSrc(name) {
      return "../../icons/".concat(name.replace(/\s/g, "-").toLowerCase()).concat(".svg");
    }

    countries.forEach(addListener);

    function addListener(country) {
      var country_code = country[0];
      document.getElementById(country_code).addEventListener('click', function() { fitRegion(country_code) });
    }

    function fitRegion(region) {

      current_region = region;

      var bboxes = countries_bbox[region][1];

      var west = bboxes[0];
      var south = bboxes[1];
      var east = bboxes[2];
      var north = bboxes[3];

      var overlay_status = document.getElementById("overlay").style.width;
      var padding_left = 50;

      if (overlay_status == '400px') {
          padding_left = 450;
      } else {
          padding_left = 50;
      }

      map.fitBounds([
          [west, south],
          [east, north]],
          {padding: {top:50, bottom:50, left:padding_left, right:50}}
      );

    };

</script>


<!-- Default Statcounter code for the map group
https://the-map-group.pictures/ -->
<script type="text/javascript">
var sc_project=12369344;
var sc_invisible=1;
var sc_security="e25c0508";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics
Made Easy - StatCounter" href="https://statcounter.com/"
target="_blank"><img class="statcounter"
src="https://c.statcounter.com/12369344/0/e25c0508/1/"
alt="Web Analytics Made Easy -
StatCounter"></a></div></noscript>
<!-- End of Statcounter Code -->

</body>
</html>
